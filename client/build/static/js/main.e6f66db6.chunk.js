(this.webpackJsonpcountdown=this.webpackJsonpcountdown||[]).push([[0],{115:function(e,t,n){e.exports=n(154)},120:function(e,t,n){},152:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=152},154:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(13),c=n.n(l),s=(n(120),n(15)),u=(n(121),n(16)),o=n(207),i=n(201),m=n(202),E=n(200),p=n(94),f=n(47),d=n(95),h=n(67),b=n(92),v=n.n(b),_=n(91),g=n.n(_),T=n(208),y=function(e){var t=e.me,n=e.players,a=e.readyStates,l=e.score;return r.a.createElement("div",null,r.a.createElement("h2",null,"Players"),0===n.length?r.a.createElement("h4",null,"Waiting for players to join..."):r.a.createElement(h.a,null,n.map((function(e){var n=t&&t.id===e.id?"".concat(e.name," (You)"):e.name,c=null,s=l?" - ".concat(l[e.id]||0):null;return t&&(c=r.a.createElement("span",{className:"mr-1"},a[e.id]?r.a.createElement(T.a,{title:"".concat(e.name," is ready")},r.a.createElement(g.a,null)):r.a.createElement(T.a,{title:"".concat(e.name," is not ready")},r.a.createElement(v.a,null)))),r.a.createElement(h.a.Item,{key:e.id},c,n,s)}))))},S=n(35),O=n(30),w=n.n(O),A=n(59),j=n(55),N=n(56),k=n(93),U=n(34),R=n.n(U);var I=new(0,n(134).default);var P=function(){function e(t){Object(j.a)(this,e),this.url=t,this.ws=null,this.ready=!1,this.message_id=0,this.requests=new Map,this.callbacks=null,this._connect()}return Object(N.a)(e,[{key:"_connect",value:function(){this.ws&&this.ws.close(),this.ws=new k.w3cwebsocket(this.url),this._attachCallbacks()}},{key:"_attachCallbacks",value:function(){var e=this,t=this.callbacks;t&&(this.ws.onopen=function(){t.onConnectionChange(!0)},this.ws.onclose=function(){t.onConnectionChange(!1),console.warn("connection closed, attempting to reconnect"),e.ws=null,e._connect()},this.ws.onmessage=function(n){var a=n.data,r=function(e){var t=null;try{return t=JSON.parse(e),R()("m_id"in t),R()("response"in t),{m_id:t.m_id,response:t.response}}catch(n){return null}}(a);if(r)e._resolveRequest(r.m_id,r.response);else{var l=function(e){var t=null;try{return t=JSON.parse(e),R()("type"in t),t}catch(n){return null}}(a);l?t.onEvent(l):console.warn("unknown message format",{data:a})}},this.ws.onerror=function(t){console.error("socket error, closing connection",t),e.ws.close()})}},{key:"setCallbacks",value:function(e){this.callbacks=e,this._attachCallbacks()}},{key:"_resolveRequest",value:function(e,t){var n,a=null==t;t=null!==(n=t)&&void 0!==n?n:{error:!0,message:"TIMEOUT"};var r=this.requests.get(e);null!=r?(clearTimeout(r.timeout),r.resolve(t),this.requests.delete(e)):a||console.warn("request ID ".concat(e," is not pending"))}},{key:"send",value:function(){var e=Object(A.a)(w.a.mark((function e(t){var n,a,r=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=I.seq(),a={m_id:n,request:t},this.ws.send(JSON.stringify(a)),e.abrupt("return",new Promise((function(e){r.requests.set(n,{resolve:e,timeout:setTimeout((function(){r._resolveRequest(n,null)}),1e3)})})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendNameUpdate",value:function(){var e=Object(A.a)(w.a.mark((function e(t){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={type:u.REQUEST_TYPE.UPDATE_NAME,newName:t},e.abrupt("return",this.send(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendToggleReadyUpdate",value:function(){var e=Object(A.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={type:u.REQUEST_TYPE.TOGGLE_READY},e.abrupt("return",this.send(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),D=r.a.createContext("lol"),G=n(96),M=function(e){var t=e.text,n=e.variant,a=void 0===n?"primary":n,l=e.isLoading,c=void 0!==l&&l,s=e.isDisabled,u=void 0!==s&&s,o=e.onClick;return r.a.createElement(G.a,{variant:a,onClick:o,disabled:u||c},c?"Loading...":t)},Y=function(){var e=Object(a.useContext)(D),t=Object(a.useState)(""),n=Object(s.a)(t,2),l=n[0],c=n[1],u=Object(a.useState)("Please enter a name"),o=Object(s.a)(u,2),i=o[0],m=o[1],E=Object(a.useState)(!1),p=Object(s.a)(E,2),f=p[0],d=p[1],h=function(){i||(0!==l.length?(d(!0),e.sendNameUpdate(l).then((function(e){e.error&&(m(e.message),d(!1))}))):m("Please enter a name"))};return r.a.createElement("div",null,r.a.createElement("h2",null,"Enter a name to join the game"),r.a.createElement(S.a,{noValidate:!0,onSubmit:function(e){e.preventDefault(),e.stopPropagation(),h()}},r.a.createElement(S.a.Group,{controlId:"nameInput"},r.a.createElement(S.a.Label,null,"Name"),r.a.createElement(S.a.Control,{onBlur:function(){var e=l.trim();e!==l&&c(e)},autoFocus:!0,isInvalid:!!i,placeholder:"Name",required:!0,value:l,onChange:function(e){var t=e.target.value;c(t),0===t.length?m("Please enter a name"):i&&m(null)},maxLength:20}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},i)),r.a.createElement(S.a.Group,{controlId:"submitButton"},r.a.createElement(M,{text:"Join",isDisabled:!!i,isLoading:f,onClick:h}))))},C=n(209),x=n(210),L=n(194),q=n(195),B=n(193),W=n(196),V=function(e){var t=e.isReady,n=Object(a.useState)(!1),l=Object(s.a)(n,2),c=l[0],u=l[1],o=Object(a.useState)(null),i=Object(s.a)(o,2),m=i[0],E=i[1],p=Object(a.useContext)(D);return r.a.createElement(x.a,{component:"fieldset"},r.a.createElement(B.a,{component:"legend"},"Game will start once all players are ready!"),r.a.createElement(L.a,{"aria-label":"position",row:!0},r.a.createElement(q.a,{control:r.a.createElement(C.a,{name:"temp",disabled:c,checked:t,onChange:function(){u(!0),E(null),p.sendToggleReadyUpdate().then((function(e){u(!1),e.error&&E(e.message)}))}}),label:"Ready",labelPlacement:"start"}),m&&r.a.createElement(W.a,{className:"ml-4",error:!0},m)))},F=n(198),J=n(156),H=n(205),Q=n(197),K=function(){return e=100,t=1e3,Math.floor(Math.random()*(t-e))+e;var e,t},$=function(e){var t=e.ms,n=void 0===t?50:t,r=Object(a.useRef)(null),l=Object(a.useState)(K()),c=Object(s.a)(l,2),u=c[0],o=c[1];return Object(a.useEffect)((function(){return r.current=setInterval((function(){r.current&&o(K())}),n),function(){clearInterval(r.current),r.current=null}}),[n]),u},z=function(e){var t=e.target,n=e.numbers,a=n.every((function(e){return null!=e}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{container:!0,spacing:8},r.a.createElement(Q.a,{item:!0,xs:!0,align:"center"},r.a.createElement("h4",null,"Target"),r.a.createElement(H.a,null,t||a&&r.a.createElement($,null)||"..."))),r.a.createElement(Q.a,{container:!0,spacing:8},r.a.createElement(Q.a,{item:!0,xs:!0,align:"center"},r.a.createElement("b",null,"Numbers:"),r.a.createElement("br",null),r.a.createElement(F.a,{variant:"text",color:"secondary",disableRipple:!0},n.map((function(e,t){return r.a.createElement(J.a,{key:t},e||"?")}))))))},X=function(e){var t=e.player_name,n=e.player_answer,a=e.player_answer_value,l=e.player_score,c=e.error_message;return r.a.createElement(Q.a,{container:!0,spacing:8},r.a.createElement(Q.a,{item:!0,xs:!0,align:"center"},n?r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,t,"'s answer"),r.a.createElement("h5",null,n||"None")):null,null!=a?r.a.createElement("h5",null,"= ",a):r.a.createElement("h5",null,c||"error"),r.a.createElement("h5",null,"Score: ",l)))},Z=n(204),ee=function(e){var t=e.message,n=e.timer,l=Object(a.useState)(n),c=Object(s.a)(l,2),u=c[0],o=c[1],i=Object(a.useRef)(null);return Object(a.useEffect)((function(){return o(n),i.current=setInterval((function(){o((function(e){return e-1}))}),1e3),function(){clearInterval(i.current),i.current=null}}),[n,t]),r.a.createElement(Q.a,{container:!0,spacing:8},r.a.createElement(Q.a,{item:!0,xs:!0,align:"center"},r.a.createElement("h3",null,t," - ",u)))},te=n(66),ne=n(41),ae=function(){function e(){Object(j.a)(this,e),this.base=[]}return Object(N.a)(e,[{key:"push",value:function(e){this.base.push(e)}},{key:"pop",value:function(){R()(this.base.length>0),this.base.pop()}},{key:"top",get:function(){return R()(this.base.length>0),this.base[this.base.length-1]}},{key:"length",get:function(){return this.base.length}},{key:"empty",get:function(){return 0===this.base.length}}]),e}(),re=function(e){e.numbers,e.isSubmitting;var t=e.inputMessage,n=e.setInputMessage,l=e.submitValue,c=e.timer,u=Object(a.useState)(""),o=Object(s.a)(u,2),i=o[0],m=o[1],E=function(){var e=function(e){if(0===(e=e.replace(/\s/g,"")).length)return"Equation is blank";if(e.length>80)return"Equation is too long";var t=new Set(Object(ne.a)("0123456789+-/*()"));if(!Object(ne.a)(e).every((function(e){return t.has(e)})))return"Equation should only contain digits (0-9) and operators (+-*/)";var n,a=new Set(Object(ne.a)("+-*/()")),r=[],l=Object(te.a)(e);try{for(l.s();!(n=l.n()).done;){var c=n.value;if(a.has(c)||0===r.length)r.push(c);else{var s=r.length-1;a.has(r[s])?r.push(c):r[s]+=c}}}catch(f){l.e(f)}finally{l.f()}for(var u={"+":0,"-":0,"/":1,"*":2},o=[],i=new ae,m=0,E=r;m<E.length;m++){var p=E[m];if(a.has(p))if("("===p)i.push(p);else if(")"===p){if(i.empty)return"mismatched parentheses";for(;"("!==i.top;)o.push(i.top),i.pop();i.pop()}else{for(;!i.empty&&"("!==i.top&&u[i.top]>=u[p];)o.push(i.top),i.pop();i.push(p)}else o.push(p)}for(;!i.empty;)o.push(i.top),i.pop();return function(){var e,t=new ae,n=Object(te.a)(o);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(a.has(r)){if(t.length<2)return"equation invalid";var l=t.top;t.pop();var c=t.top;t.pop(),t.push({type:r,a:c,b:l})}else t.push(Number(r))}}catch(f){n.e(f)}finally{n.f()}return 1!==t.length?"equation invalid":t.top}()}(i);"string"===typeof e?n("Error: ".concat(e)):l(i)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{container:!0,spacing:8},r.a.createElement(Q.a,{item:!0,xs:!0,align:"center"},r.a.createElement(Z.a,{label:"Equation",rows:4,value:i,onChange:function(e){var t=e.target.value;0===t.length?n("Error: empty"):n(""),m(t)},variant:"outlined",helperText:t,onKeyPress:function(e){"Enter"===e.key&&E()}}))),r.a.createElement(Q.a,{container:!0,spacing:8},r.a.createElement(Q.a,{item:!0,xs:!0,align:"center"},c&&r.a.createElement(ee,{timer:c,message:"Time left"}),r.a.createElement(J.a,{onClick:E,color:"primary",variant:"contained"},"Submit"))))},le=function(e){var t=e.gameState,n=(e.players,Object(a.useContext)(D)),l=Object(a.useState)(!1),c=Object(s.a)(l,2),o=c[0],i=c[1],m=Object(a.useState)(null),E=Object(s.a)(m,2),p=E[0],f=E[1],d=function(e){var t={type:u.REQUEST_TYPE.SUBMIT_ANSWER,text:e};i(!0),f(null),n.send(t).then((function(e){i(!1),e.error?f("Error: ".concat(e.message)):f("Answer Submitted!")}))};if(null==t)return r.a.createElement("div",null,"game state loading");var h=function(){switch(t.status){case u.GAME_STATUS.WAITING:return r.a.createElement(ee,{message:t.message,timer:t.timer});case u.GAME_STATUS.ROUND_STARTING:case u.GAME_STATUS.ROUND_STARTED:case u.GAME_STATUS.ROUND_FINISHED:return r.a.createElement("div",null,r.a.createElement(z,{target:t.target,numbers:t.numbers}),t.target&&r.a.createElement(re,{submitValue:d,inputMessage:p,setInputMessage:f,isSubmitting:o,numbers:t.numbers,timer:t.timer}));case u.GAME_STATUS.SHOWING_ANSWER:return r.a.createElement("div",null,r.a.createElement(z,{target:t.target,numbers:t.numbers}),r.a.createElement(X,{player_name:t.player_name,player_score:t.player_score,player_answer_value:t.player_answer_value,player_answer:t.player_answer,error_message:t.error_message}));default:return null}}();return r.a.createElement("div",null,r.a.createElement("span",null,"Round ",t.current_round," of ",t.total_rounds),h)},ce=function(e){var t=e.me,n=e.readyStates,a=e.lobbyState,l=e.gameState,c=e.players,s=Boolean(n[t.id]);switch(a){case null:case u.LOBBY_STATE.WAITING_FOR_PLAYERS:return r.a.createElement(V,{isReady:s});case u.LOBBY_STATE.IN_GAME:return r.a.createElement(le,{gameState:l,players:c});default:return console.error("Unexpected lobby state!",a),null}},se=new P("ws://localhost:3001"),ue=function(){var e=Object(a.useState)(!0),t=Object(s.a)(e,2),n=t[0],l=t[1],c=Object(a.useState)([]),h=Object(s.a)(c,2),b=h[0],v=h[1],_=Object(a.useState)({}),g=Object(s.a)(_,2),T=g[0],S=g[1],O=Object(a.useState)(null),w=Object(s.a)(O,2),A=w[0],j=w[1],N=Object(a.useState)(null),k=Object(s.a)(N,2),U=k[0],R=k[1],I=Object(a.useState)(null),P=Object(s.a)(I,2),G=P[0],M=P[1],C=b.find((function(e){return e.id===G}));return Object(a.useEffect)((function(){se.setCallbacks({onConnectionChange:function(e){setTimeout((function(){l(!e),e||M(null)}),250)},onEvent:function(e){switch(e.type){case u.EVENT_TYPE.ID_UPDATE:M(e.id);break;case u.EVENT_TYPE.PLAYER_LIST_UPDATE:v(e.players);break;case u.EVENT_TYPE.READY_STATES_UPDATE:S(e.ready_states);break;case u.EVENT_TYPE.LOBBY_STATE_UPDATE:j(e.state);break;case u.EVENT_TYPE.GAME_STATE_UPDATE:R(e.state);break;default:console.error("unknown event",e)}}})}),[]),r.a.createElement(D.Provider,{value:se},r.a.createElement(E.a,{className:"my-5"},r.a.createElement(p.a,null,r.a.createElement("div",null),r.a.createElement(d.a,null,r.a.createElement(f.a,{xs:3},r.a.createElement(y,{me:C,players:b,readyStates:T,score:U&&U.score})),r.a.createElement(f.a,null,C?r.a.createElement(ce,{me:C,readyStates:T,lobbyState:A,gameState:U,players:b}):r.a.createElement(Y,null)))),r.a.createElement(o.a,{open:n,p:5},r.a.createElement(i.a,null,r.a.createElement("div",null,"Connecting to server..."),r.a.createElement(m.a,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ue,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},16:function(e,t,n){"use strict";n.d(t,"LOBBY_STATE",(function(){return s}));var a=n(73);n.d(t,"REQUEST_TYPE",(function(){return a.a}));var r=n(74);n.o(r,"EVENT_TYPE")&&n.d(t,"EVENT_TYPE",(function(){return r.EVENT_TYPE})),n.o(r,"GAME_STATUS")&&n.d(t,"GAME_STATUS",(function(){return r.GAME_STATUS}));var l=n(75);n.d(t,"EVENT_TYPE",(function(){return l.a}));var c=n(76);n.d(t,"GAME_STATUS",(function(){return c.a}));var s={WAITING_FOR_PLAYERS:"waiting_for_players",IN_GAME:"in_game"}},73:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={UPDATE_NAME:"update_name",TOGGLE_READY:"toggle_ready",SUBMIT_ANSWER:"submit_answer"}},74:function(e,t){},75:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={PLAYER_LIST_UPDATE:"player_list_update",READY_STATES_UPDATE:"ready_states_update",ID_UPDATE:"id_update",LOBBY_STATE_UPDATE:"lobby_state_update",GAME_STATE_UPDATE:"game_state_update"}},76:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(97),r=Object(a.a)({},{WAITING:"waiting",SHOWING_ANSWER:"showing_answer"},{},{ROUND_STARTING:"round_starting",ROUND_STARTED:"round_started",ROUND_FINISHED:"round_finished"})}},[[115,1,2]]]);
//# sourceMappingURL=main.e6f66db6.chunk.js.map